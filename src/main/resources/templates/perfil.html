<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Mi Perfil</title>
    <link rel="stylesheet" th:href="@{/perfil.css}">
</head>
<body>

<div class="perfil-container">
    <div class="perfil-card">

        <!-- T√≠tulo -->
        <h1>Mi Perfil</h1>

        <!-- Mensajes de √©xito -->
        <div th:if="${param.ok}" class="mensaje-success">
            ‚úì Datos actualizados correctamente.
        </div>
        <div th:if="${param.foto}" class="mensaje-success">
            ‚úì Foto actualizada.
        </div>

        <!-- Mensaje de error -->
        <div th:if="${errorImagen}" class="mensaje-error" th:text="${errorImagen}"></div>

        <!-- FOTO DE PERFIL INTERACTIVA -->
        <div class="foto-container">
            <div class="foto-wrapper">
                <img class="perfil-foto"
                     th:src="${usuario.fotoPerfil != null} ? ${usuario.fotoPerfil} : '/img/default-user.png'"
                     alt="Foto de perfil"
                     id="previewFoto">
                <div class="foto-overlay">
                    <span class="foto-icon">üì∑</span>
                </div>
            </div>
            <p class="foto-hint">Haz clic en la foto para cambiarla</p>
            
            <!-- Formulario oculto para subir foto -->
            <form id="formFoto" th:action="@{/perfil/foto}" method="post" enctype="multipart/form-data">
                <input type="file" 
                       id="inputFoto" 
                       name="foto" 
                       accept="image/*" 
                       style="display:none"
                       onchange="document.getElementById('formFoto').submit();" />
            </form>
        </div>

        <div class="divider"></div>

        <!-- FORMULARIO DE DATOS DEL PERFIL -->
        <form th:action="@{/perfil/actualizar}" method="post" class="perfil-form">

            <div class="input-group">
                <label for="nombre">Nombre</label>
                <input type="text" id="nombre" name="nombre" th:value="${usuario.nombre}" placeholder="Tu nombre completo" required>
            </div>

            <div class="input-group">
                <label for="correo">Correo</label>
                <input type="email" id="correo" name="correo" th:value="${usuario.correo}" placeholder="correo@ejemplo.com" required>
            </div>

            <div class="input-group">
                <label for="telefono">Tel√©fono</label>
                <input type="text" id="telefono" name="telefono" th:value="${usuario.telefono}" placeholder="N√∫mero de contacto">
            </div>

            <div class="input-group">
                <label for="direccion">Direcci√≥n</label>
                <input type="text" id="direccion" name="direccion" th:value="${usuario.direccion}" placeholder="Tu direcci√≥n">
            </div>

            <div class="input-group" th:if="${usuario.idRol == 3}">
                <label for="empresa">Empresa</label>
                <input type="text" id="empresa" name="empresa" th:value="${usuario.empresa}" placeholder="Nombre de la empresa">
            </div>

            <div class="input-group" th:if="${usuario.idRol == 3}">
                <label for="nit">NIT</label>
                <input type="text" id="nit" name="nit" th:value="${usuario.nit}" placeholder="NIT de la empresa">
            </div>

            <button type="submit" class="btn-guardar">Guardar cambios</button>
        </form>

        <div class="divider"></div>

        <!-- ZONA DE PELIGRO -->
        <div class="zona-peligro">
            <h3>Zona de peligro</h3>
            <p>Una vez que elimines tu cuenta, no hay vuelta atr√°s. Por favor, ten certeza.</p>
            <form th:action="@{'/admin/usuarios/eliminar/' + ${usuario.id}}" method="get"
                  onsubmit="return confirm('¬øSeguro que deseas eliminar tu cuenta? Esta acci√≥n no se puede deshacer.')">
                <button type="submit" class="btn-eliminar">Eliminar cuenta</button>
            </form>
        </div>

        <!-- Enlace para volver -->
        <div class="volver-link">
            <a th:href="@{/}">‚Üê Volver al inicio</a>
        </div>
    </div>
</div>

<script>
    // Al hacer click en la imagen o el overlay ‚Üí abrir selector de archivos
    document.getElementById('previewFoto').addEventListener('click', function () {
        document.getElementById('inputFoto').click();
    });
    
    document.querySelector('.foto-overlay').addEventListener('click', function () {
        document.getElementById('inputFoto').click();
    });
</script>

</body>
</html>