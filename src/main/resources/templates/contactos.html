<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Vendedores</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Poppins', sans-serif;
        background: linear-gradient(135deg, #0f1724 0%, #111827 60%, #0b1220 100%);
        min-height: 100vh;
        color: #e6edf3;
      }

      /* Navbar Elegante */
      .navbar {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px 0;
        box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .navbar-brand {
        font-weight: 800;
        color: white !important;
        font-size: 32px;
        letter-spacing: 1px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
      }

      .nav-links {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
      }

      .nav-btn {
        padding: 10px 24px;
        border: 2px solid rgba(255,255,255,0.3);
        border-radius: 25px;
        color: white;
        text-decoration: none;
        font-weight: 500;
        font-size: 14px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(10px);
      }

      .nav-btn:hover {
        background: rgba(255,255,255,0.25);
        border-color: rgba(255,255,255,0.5);
        color: white;
        transform: translateY(-2px);
      }

      .nav-btn.logout {
        background: rgba(255,255,255,0.95);
        color: #667eea;
        border: none;
      }

      .nav-btn.logout:hover {
        color: #667eea;
      }

      .navbar-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        flex-wrap: wrap;
        gap: 20px;
      }

      /* Hero Section */
      .hero-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 60px 0;
        color: white;
        position: relative;
        overflow: hidden;
      }

      .hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="0.5" fill="rgba(255,255,255,0.1)"/></svg>');
        opacity: 0.1;
      }

      .hero-content {
        position: relative;
        z-index: 2;
        text-align: center;
      }

      .hero-content h1 {
        font-size: 3rem;
        font-weight: 800;
        margin-bottom: 15px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
      }

      .hero-content p {
        font-size: 1.3rem;
        opacity: 0.95;
        margin-bottom: 30px;
      }

      /* Stats Bar */
      .stats-container {
        background: white;
        border-radius: 20px;
        padding: 30px;
        margin: -40px auto 40px;
        max-width: 1200px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        position: relative;
        z-index: 10;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 30px;
        text-align: center;
      }

      .stat-card {
        padding: 20px;
        border-radius: 15px;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        transition: all 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
      }

      .stat-icon {
        width: 60px;
        height: 60px;
        margin: 0 auto 15px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
      }

      .stat-number {
        font-size: 2.5rem;
        font-weight: 800;
        color: #667eea;
        margin-bottom: 5px;
      }

      .stat-label {
        color: #6c757d;
        font-size: 0.95rem;
        font-weight: 500;
      }

      /* Vendors Section */
      .vendors-section {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px 60px;
      }

      .section-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: #e6edf3;
        margin-bottom: 40px;
        text-align: center;
      }

      /* Table Styling */
      .table-container {
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 30px rgba(0,0,0,0.1);
        overflow: hidden;
        margin-bottom: 40px;
      }

      .table {
        margin-bottom: 0;
      }

      .table th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        font-weight: 600;
        border: none;
        padding: 18px;
        text-transform: uppercase;
        font-size: 0.9rem;
        letter-spacing: 0.5px;
      }

      .table td {
        color: #495057;
        border: 1px solid #e9ecef;
        padding: 16px 18px;
        vertical-align: middle;
      }

      .table tbody tr {
        transition: all 0.3s ease;
      }

      .table tbody tr:hover {
        background-color: #f8f9fa;
        box-shadow: inset 0 0 0 1px rgba(102, 126, 234, 0.1);
      }

      .table tbody tr:last-child td {
        border-bottom: none;
      }

      /* Botón Ver Perfil en Tabla */
      .btn-ver-perfil {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 8px 20px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
      }

      .btn-ver-perfil:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      /* Modal de Perfil */
      .modal-perfil .modal-content {
        border-radius: 20px;
        border: none;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      }

      .modal-perfil .modal-header {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border: none;
        padding: 20px 30px;
      }

      .modal-perfil .modal-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1a202c;
      }

      .modal-perfil .modal-body {
        padding: 30px;
        background: white;
      }

      .perfil-container {
        text-align: center;
      }

      .perfil-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 3rem;
        font-weight: bold;
        margin: 0 auto 20px;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        overflow: hidden;
      }

      .perfil-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .perfil-avatar-letra {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
      }

      .perfil-nombre {
        font-size: 1.8rem;
        font-weight: 700;
        color: #1a202c;
        margin-bottom: 5px;
      }

      .perfil-email {
        color: #718096;
        font-size: 1rem;
        margin-bottom: 5px;
      }

      .perfil-telefono {
        color: #718096;
        font-size: 1rem;
        margin-bottom: 20px;
      }

      .perfil-info {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        padding: 20px;
        border-radius: 12px;
        margin-top: 20px;
        text-align: left;
      }

      .perfil-info-item {
        margin-bottom: 10px;
        color: #495057;
        font-size: 0.95rem;
      }

      .perfil-info-item:last-child {
        margin-bottom: 0;
      }

      .perfil-info-item strong {
        color: #667eea;
        font-weight: 600;
      }

      .modal-perfil .modal-footer {
        background: #f8f9fa;
        border: none;
        padding: 20px 30px;
      }

      .btn-editar {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        border: none;
        padding: 10px 24px;
        border-radius: 20px;
        font-weight: 600;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn-editar:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        color: white;
      }

      .btn-cerrar {
        background: #6c757d;
        color: white;
        border: none;
        padding: 10px 24px;
        border-radius: 20px;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .btn-cerrar:hover {
        background: #5a6268;
        color: white;
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 80px 20px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 30px rgba(0,0,0,0.08);
      }

      .empty-icon {
        width: 120px;
        height: 120px;
        margin: 0 auto 30px;
        background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .empty-icon i {
        font-size: 3.5rem;
        color: #adb5bd;
      }

      .empty-state h3 {
        font-size: 1.8rem;
        color: #495057;
        margin-bottom: 15px;
        font-weight: 700;
      }

      .empty-state p {
        color: #6c757d;
        font-size: 1.1rem;
      }

      /* Botón de acción */
      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        padding: 12px 32px;
        font-size: 1rem;
        border-radius: 30px;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        transition: all 0.3s ease-in-out;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin-top: 30px;
      }

      .btn-primary:hover {
        background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        transform: translateY(-2px);
        color: white;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      }

      /* Responsive */
      @media (max-width: 768px) {
        .hero-content h1 {
          font-size: 2rem;
        }

        .hero-content p {
          font-size: 1.1rem;
        }

        .navbar-container {
          flex-direction: column;
        }

        .nav-links {
          justify-content: center;
        }

        .section-title {
          font-size: 1.5rem;
        }

        .table th, .table td {
          padding: 12px;
          font-size: 0.9rem;
        }

        .stats-grid {
          grid-template-columns: 1fr;
          gap: 20px;
        }

        .btn-ver-perfil {
          padding: 6px 14px;
          font-size: 0.85rem;
        }
      }

      @media (max-width: 576px) {
        .vendors-section {
          padding: 0 12px 40px;
        }

        .table-container {
          border-radius: 12px;
        }

        .table th {
          font-size: 0.8rem;
          padding: 12px 8px;
        }

        .table td {
          padding: 10px 8px;
          font-size: 0.85rem;
        }

        .section-title {
          font-size: 1.3rem;
        }

        .btn-ver-perfil {
          padding: 5px 12px;
          font-size: 0.8rem;
        }
      }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
  <div class="container navbar-container">
    <a class="navbar-brand" href="/bienvenida">CONFER</a>
    <div class="nav-links">
      <a href="/indexProductos" class="nav-btn" th:if="${usuario != null}">
        <i class="fas fa-shopping-bag"></i>
        <span>Productos</span>
      </a>
      <a href="/perfil" class="nav-btn" th:if="${usuario != null}">
        <i class="fas fa-user-circle"></i>
        <span>Mi Perfil</span>
      </a>
      <a href="#" class="nav-btn logout" th:if="${usuario != null}" onclick="return confirmarCerrarSesion(event)">
        <i class="fas fa-sign-out-alt"></i>
        <span>Cerrar sesión</span>
      </a>
      <a href="/login" class="nav-btn" th:if="${usuario == null}" style="background: linear-gradient(135deg, #ff9a56 0%, #ff7e5f 100%); border-color: rgba(255,158,86,0.5);">
        <i class="fas fa-sign-in-alt"></i>
        <span>Iniciar sesión</span>
      </a>
      <a href="/bienvenida" class="nav-btn" style="background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.4);">
        <i class="fas fa-arrow-left"></i>
        <span>Volver</span>
      </a>
    </div>
  </div>
</nav>

<!-- Hero Section -->
<section class="hero-section">
  <div class="container hero-content">
    <h1><i class="fas fa-network-wired"></i> Red de Vendedores</h1>
    <p>Conecta con los mejores vendedores de nuestra plataforma</p>
  </div>
</section>

<!-- Stats Container -->
<div class="container">
  <div class="stats-container">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-user-tie"></i>
        </div>
        <div class="stat-number" th:text="${vendedores != null ? vendedores.size() : 0}">0</div>
        <div class="stat-label">Vendedores Activos</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-envelope"></i>
        </div>
        <div class="stat-number" th:text="${usuario != null ? '✓' : '–'}">–</div>
        <div class="stat-label" th:text="${usuario != null ? 'Acceso Disponible' : 'Inicia Sesión'}">Acceso</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-handshake"></i>
        </div>
        <div class="stat-number">∞</div>
        <div class="stat-label">Oportunidades de Negocio</div>
      </div>
    </div>
  </div>
</div>

<!-- Vendors Section -->
<section class="vendors-section">
  <h2 class="section-title">
    <i class="fas fa-list-ul"></i> Lista de Vendedores
  </h2>

  <!-- Tabla de vendedores -->
  <th:block th:if="${usuario != null and vendedores != null and !vendedores.empty}">
    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th><i class="fas fa-user"></i> Nombre</th>
            <th><i class="fas fa-envelope"></i> Email</th>
            <th><i class="fas fa-phone"></i> Teléfono</th>
            <th style="text-align: center;"><i class="fas fa-cog"></i> Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="vendedor : ${vendedores}">
            <td th:text="${vendedor.nombre}"></td>
            <td th:text="${vendedor.correo}"></td>
            <td th:text="${vendedor.telefono}"></td>
            <td style="text-align: center;">
              <button class="btn-ver-perfil" 
                      th:attr="data-id=${vendedor.id},
                               data-nombre=${vendedor.nombre},
                               data-correo=${vendedor.correo},
                               data-telefono=${vendedor.telefono},
                               data-empresa=${vendedor.empresa},
                               data-direccion=${vendedor.direccion},
                               data-nit=${vendedor.nit},
                               data-foto=${vendedor.fotoPerfil != null ? '/uploads/' + vendedor.fotoPerfil : ''}"
                      onclick="verPerfil(this)">
                <i class="fas fa-user-circle"></i> Ver Perfil
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </th:block>

  <!-- Estado vacío cuando no hay acceso -->
  <th:block th:if="${usuario == null}">
    <div class="empty-state">
      <div class="empty-icon">
        <i class="fas fa-lock"></i>
      </div>
      <h3>Acceso Restringido</h3>
      <p>Debes iniciar sesión para ver la información de los vendedores y conectar con ellos.</p>
      <a href="/login" class="btn btn-primary">
        <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
      </a>
    </div>
  </th:block>

  <!-- Estado vacío cuando la tabla está vacía -->
  <th:block th:if="${usuario != null and (vendedores == null or vendedores.empty)}">
    <div class="empty-state">
      <div class="empty-icon">
        <i class="fas fa-inbox"></i>
      </div>
      <h3>Sin vendedores disponibles</h3>
      <p>En este momento no hay vendedores registrados en nuestra plataforma. ¡Intenta de nuevo más tarde!</p>
    </div>
  </th:block>

</section>

<!-- Modal de Perfil del Vendedor -->
<div class="modal fade modal-perfil" id="perfilModal" tabindex="-1" aria-labelledby="perfilModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="perfilModalLabel">Mi Perfil</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="perfil-container">
          <div class="perfil-avatar" id="perfilAvatar">
            <div class="perfil-avatar-letra" id="perfilAvatarLetra">J</div>
          </div>
          <div class="perfil-nombre" id="perfilNombre">jonny</div>
          <div class="perfil-email" id="perfilEmail">jonny@gmail.com</div>
          <div class="perfil-telefono" id="perfilTelefono">32222222</div>
          
          <div class="perfil-info">
            <div class="perfil-info-item">
              <strong>Empresa:</strong> <span id="perfilEmpresa">jonny</span>
            </div>
            <div class="perfil-info-item">
              <strong>Dirección:</strong> <span id="perfilDireccion">CL 23 #72D-27</span>
            </div>
            <div class="perfil-info-item">
              <strong>NIT:</strong> <span id="perfilNit">20886557</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-cerrar" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function confirmarCerrarSesion(event) {
    event.preventDefault();
    Swal.fire({
      title: '¿Cerrar sesión?',
      text: '¿Estás seguro de que deseas cerrar sesión?',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#667eea',
      cancelButtonColor: '#6c757d',
      confirmButtonText: 'Sí, cerrar',
      cancelButtonText: 'Cancelar'
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = '/logout';
      }
    });
    return false;
  }

  function verPerfil(button) {
    // Obtener los datos del vendedor
    const id = button.getAttribute('data-id');
    const nombre = button.getAttribute('data-nombre');
    const correo = button.getAttribute('data-correo');
    const telefono = button.getAttribute('data-telefono');
    const empresa = button.getAttribute('data-empresa') || nombre;
    const direccion = button.getAttribute('data-direccion') || 'No especificada';
    const nit = button.getAttribute('data-nit') || 'No especificado';
    const fotoPerfil = button.getAttribute('data-foto');

    // Obtener la inicial para el avatar
    const inicial = nombre.charAt(0).toUpperCase();

    // Limpiar el contenedor del avatar
    const avatarContainer = document.getElementById('perfilAvatar');
    avatarContainer.innerHTML = '';

    // Si tiene foto de perfil, mostrarla; si no, mostrar la letra
    if (fotoPerfil && fotoPerfil.trim() !== '') {
      const img = document.createElement('img');
      img.src = fotoPerfil;
      img.alt = nombre;
      img.onerror = function() {
        // Si la imagen falla al cargar, mostrar la letra
        avatarContainer.innerHTML = '<div class="perfil-avatar-letra">' + inicial + '</div>';
      };
      avatarContainer.appendChild(img);
    } else {
      // No tiene foto, mostrar la letra
      avatarContainer.innerHTML = '<div class="perfil-avatar-letra">' + inicial + '</div>';
    }

    // Actualizar el resto de la información
    document.getElementById('perfilNombre').textContent = nombre;
    document.getElementById('perfilEmail').textContent = correo;
    document.getElementById('perfilTelefono').textContent = telefono;
    document.getElementById('perfilEmpresa').textContent = empresa;
    document.getElementById('perfilDireccion').textContent = direccion;
    document.getElementById('perfilNit').textContent = nit;

    // Mostrar el modal
    const modal = new bootstrap.Modal(document.getElementById('perfilModal'));
    modal.show();
  }
</script>

</body>
</html>